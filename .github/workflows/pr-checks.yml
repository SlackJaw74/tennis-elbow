name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - main
      - master

jobs:
  swiftlint:
    name: SwiftLint
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install SwiftLint
        run: brew install swiftlint
      
      - name: Run SwiftLint
        run: |
          cd TennisElbow
          swiftlint lint --reporter github-actions-logging

  build-and-test:
    name: Build and Test
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Show Xcode version
        run: xcodebuild -version
      
      - name: Build app
        run: |
          xcodebuild \
            -project "TennisElbow/TennisElbow.xcodeproj" \
            -scheme "TennisElbow" \
            -configuration Debug \
            -sdk iphonesimulator \
            -destination "platform=iOS Simulator,name=iPhone 15 Pro" \
            clean build
      
      - name: Run UI Tests
        run: |
          xcodebuild test \
            -project "TennisElbow/TennisElbow.xcodeproj" \
            -scheme "TennisElbow" \
            -configuration Debug \
            -sdk iphonesimulator \
            -destination "platform=iOS Simulator,name=iPhone 15 Pro" \
            -enableCodeCoverage YES

  swiftformat:
    name: SwiftFormat Check
    runs-on: macos-latest
    continue-on-error: true  # Don't fail the build on formatting issues initially
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install SwiftFormat
        run: brew install swiftformat
      
      - name: Run SwiftFormat (lint mode)
        run: |
          cd TennisElbow
          swiftformat --lint .
